<script>
	window._AppName = "fe"
	back=window.parent.hmm.t("apps.fe.goback")
</script>
<link rel="stylesheet" href="style.css">
<style>
	body {
		overflow: auto;
	}

	div.file {
		background-color: #000;
		border-radius: 5px;
		border: 2px solid #fff;
		border-bottom: 1px solid #fff;
		border-top: 1px solid #fff;
	}

	div.folder::after {
		content: ">";
		float: right;
		color: #aaa;
	}
	
	div.add{
		color:#05d;
	}

	#pathlabel {
		font-family: menlo, monospace;
	}
</style>
<span id="pathlabel"></span>
<div id="files"></div>
<div id="add" onclick="
//TODO: i18n
hmm.popup(`Enter a name for your file<br>
<input id=n><br><button default>create</button><button id=no>cancel</button>`).then(e=>{
//window.parent.console.log(e)
	if(e.button=='no')return
	var n=e.popup.querySelector('#n').value
	if(n in hmm.pathToJs(path)){hmm.popup('File already exists<br><button default>OK');return}
	eval(hmm.pathToDot(path+n)+'=``')
	loadpath()
})
" class="add file"></div>
<script>
	window.hmm = window.parent.hmm;
	path = "/"
	document.getElementById("add").innerText=hmm.t("apps.fe.addfile")
	loadpath=()=>{
		document.getElementById('pathlabel').innerText = path
		document.getElementById('files').innerHTML = (path != "/") ? `
			<div class="file" style="color:#05d" onclick="path=path.slice(0,path.slice(0,-1).lastIndexOf('/')+1);loadpath()">&larr; ${back}</div>
			`: ''
		Object.keys(hmm.pathToJs(path)).sort().forEach(e => {
			var el = document.createElement('div')
			el.classList.add('file')
			if (typeof (hmm.pathToJs(path)[e]) == "object") {
				el.classList.add('folder')
				el.onclick = () => {
					path += e + '/'
					loadpath()
				}
			}else{
				el.onclick=(ev)=>{
					hmm.$("open "+path+ev.target.innerText)
				}
			}
			if (e.startsWith('.')) el.style.color = "#aaa"
			el.innerText = e
			document.getElementById('files').appendChild(el)
		})
	}
	setTimeout(()=>{
		if((window.arg||'').startsWith("$open ")){
			path=window.arg.slice(6)
			loadpath()
		}
	},100)
	loadpath()
</script>